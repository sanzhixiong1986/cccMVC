# cocos优化

### 方法

- 优化的本质是什么

（1）找到问题，定位问题。

（2）分析问题，是否合理，不合理就修正。

（3）解决问题的方案。

- 如何优化体积大小

  分析包体

  (1)代码体积（引擎代码，用户编写的代码，容易忽略的代码setting,js)

  打包以后，cocos2d-js-min.js 是这个引擎的代码的大小（如果你有一些引擎用不上可以用模块下面去删除对应的模块可以减小体积）项目设置->模块设置

  (2) setting.js 取决于你的resources这个文件下的资源，资源越大，这个文件就越大，优化的方式，凡是不用外部加载的资源都不要放在这个文件下面。

- 图片体积（一张图片的文件大小）

  分辨：分辨率越大，体积越大

  压缩算法：png，bmp，jpg 无需alpha的话使用jpg

  图片的数目：最大的限度的重用图片

  九宫格：拉伸缩房，指定缩房图片区域的，如果能用九宫格的缩放就用九宫格，九宫格可以使用小的分辨率的图去做大的设计，这样可以减少体积。

  使用压缩软件可以缩小体积。

  图集：我们尽可能让图集没有空白区域，优点：可以减少体积，减少drawcall的绘制。

- 动画体积

  序列帧动画：一秒多少张图，简单，图片数目增加了，体积就会增加，尽量减少图片的数量

  骨骼动画：内存资源使用的少，动画的计算比较大，所以性能比较差。

- 地图数据体积

  根据实际需要，采用压缩的算法

- 声音

  压缩算法：wav>ogg>mp3，mp3有版权问题，尽量用ogg

  算法参数：使用格式工厂进行参数减少和增加 码率，采样率，声道（双声道，单声道）

- 如何优化游戏运行的内存

  (1)分析内存的组成

  ​	图片比较多；减少分辨率，减少数量，尽量使用九宫格，图片的节约出来

  (2)分析内存是否合理

  ​	找出不合理的点；

- 如何优化资源装在导致的卡顿

  提前预加载：这样在使用的时候就不会出现资源部存在，卡顿等一般情况。

- DrawCall 是什么

  游戏引擎通过cpu绘制一些数据，然后传给gpu进行绘制，gpu处理绘制都是以三角形为单元进行绘制，cpu分几次进行提交给gpu进行处理就是几个drawcall。

- 为什么drawcall越少，性能越好

  cpu传的次数越少，那么一次传送的数据就越多，这样cpu的性能也提高了，gpu的性能也充分提高。

- 字库的大小压缩

  1.减少字库的文字，只要使用的就可以，不使用的就不需要

  2.使用图片进行制作字库，这样在label越多的情况下，使用图片字库，体积小，性能好参考label使用图片字库以后的drawcall减少

- label的性能优化

  lable的渲染：先读取文字，然后在将文字渲染到一个纹理上，最后使用精灵进行绘制，每一个label的性能都会产生一个drawcall。

  label优化：lable的bitmap模式将label绘制在哦你给一个贴图里面，这样drawcall就会减少

- ccc内存池何时使用

  内存池是针对反复构造的对象，如果不使用内存池，每次创建释放会比较大的负担，所以当我们经常创建和销毁某个物体的时候我们就会使用内存池

- ccc如何查看游戏运行时的内存？

  开发的时候,查看内存占用是常用的调试手段，Cocos Creator如何查看游戏运行时的内存的详情呢？我们可以把Cocos Creator切换到浏览器预览的模式，运行游戏，游戏在浏览器中运行起来，按F12，点开开发选项的”Memory”, 点击内存快照，这样就把整个内存占用的情况给你列出来了。哪些类型的对象占了多少内存，这样你就能分析出来内存的分布情况。如下图

  ![](/Users/joy/Documents/GitHub/cccMVC/1.png)

![](/Users/joy/Documents/GitHub/cccMVC/2.png)

- 如何做profiler函数分析

  我们可以把Cocos Creator切换到浏览器预览的模式，运行游戏，游戏在浏览器中运行起来，按F12, 打开Performance 

  ![](/Users/joy/Documents/GitHub/cccMVC/3.png)

![](/Users/joy/Documents/GitHub/cccMVC/4.png)

------

- 出现卡一下，或者声音出现有停顿的问题

  这些问题总结起来就是没有进行提前的预加载，如果预加载了基本就不会出现卡顿等问题

------

- 使用sprite进行制作进度条

  Cocos Creator 的cc.Sprite有一个fill模式，可以根据比例来填充精灵，它分为fillStart, fillRange, fillStart是开始的位置，fillRange是填充范围，大小为(0, 1.0), 0为没有大小, 1为全部的大小，如果是0.6就显示百分之60%, fill模式有三种形状，水平，垂直, 扇形。所以当我们要做进度条的时候，可以使用精灵的fill模式来做，然后代码获取精灵组件，直接设置精灵组件的fillRange就可以改变进度。这样就可以把模块的那个进度条模块给删除剩下一些空间。

------

